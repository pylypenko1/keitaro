"undefined"!=typeof jQuery&&("undefined"==typeof ARK&&(ARK={}),jQuery((function($){"use strict";function getElement(t){return"string"===$.type(t)?$("#"+t):t.jquery&&t||$(t)}function getCompatElement(t){var e=t.ownerDocument||t.document||t;return e.compatMode&&"CSS1Compat"!=e.compatMode?e.body:e.documentElement}function getSize(t){var e=getCompatElement(t);return{x:e.clientWidth,y:e.clientHeight}}function getScroll(t){var e=$(t).is("window")?t:t.parentWindow||t.defaultView,i=getCompatElement(t);return{x:e.pageXOffset||i.scrollLeft,y:e.pageYOffset||i.scrollTop}}function getScrollSize(t){var e=getCompatElement(t),i=getSize(t),s=(t.ownerDocument||t.document||t).body;return{x:Math.max(e.scrollWidth,s.scrollWidth,i.x),y:Math.max(e.scrollHeight,s.scrollHeight,i.y)}}function parseJson(str,secure){return secure?$.parseJSON(str):eval("("+str+")")}"object"!=typeof SqueezeBox&&(ARK.squeezeBox={presets:{onOpen:function(){},onClose:function(){},onUpdate:function(){},onResize:function(){},onMove:function(){},onShow:function(){},onHide:function(){},size:{x:600,y:450},sizeLoading:{x:200,y:150},marginInner:{x:20,y:20},marginImage:{x:50,y:75},handler:!1,target:null,closable:!0,closeBtn:!0,zIndex:65555,overlayOpacity:.7,classWindow:"",classOverlay:"",overlayFx:{},resizeFx:{},contentFx:{},parse:!1,parseSecure:!1,shadow:!0,overlay:!0,document:null,ajaxOptions:{},animate:{overlay:250,win:75,content:450},iframePreload:!1},initialize:function(t){if(this.options)return this;var e=$.extend({},this.presets,t);return this.doc=this.presets.document||document,this.options={},this.setOptions(e),this.build(),this.bound={window:$.proxy(this.reposition,this,[null]),scroll:$.proxy(this.checkTarget,this),close:$.proxy(this.close,this),key:$.proxy(this.onKey.bind,this)},this.isOpen=this.isLoading=!1,this},addEvents:function(){var t=this;$.each(this,(function(e,i){$.isFunction(i)&&/^on/.test(e)&&($(t).on(e,$.proxy(t.prop)),delete t.options[e])}))},setOptions:function(t){$.extend(this.options,this.presets,t||{}),this.addEvents()},build:function(){if(this.overlay=$("<div></div>").attr({id:"sbox-overlay","aria-hidden":"true",tabindex:-1}).css("z-index",this.options.zIndex),this.win=$("<div></div>").attr({id:"sbox-window",role:"dialog","aria-hidden":"true"}).css("z-index",this.options.zIndex+2),this.options.shadow){window.attachEvent&&!window.addEventListener||this.win.addClass("shadow");var t=$("<div></div>").attr({class:"sbox-bg-wrap"}).appendTo(this.win),e=$.proxy((function(t){this.overlay.trigger("click",[t])}),this);$.each(["n","ne","e","se","s","sw","w","nw"],(function(i,s){$("<div></div>").attr({class:"sbox-bg sbox-bg-"+s}).appendTo(t).click(e)}))}this.content=$("<div></div>").attr({id:"sbox-content"}).appendTo(this.win),this.closeBtn=$("<a></a>").attr({id:"sbox-btn-close",href:"#",role:"button"}).appendTo(this.win),$(this.closeBtn).attr("aria-controls","sbox-window"),$(this.doc.body).append(this.overlay,this.win)},assign:function(t,e){var i=getElement(t);return(i.length&&i||"string"===$.type(t)&&$("."+t)||$(null)).click((function(t){return t.preventDefault(),t.stopPropagation(),!ARK.squeezeBox.fromElement(this,e)}))},open:function(t,e){if(this.initialize(),null!=this.element&&this.trash(),this.element=getElement(t)||!1,this.setOptions($.extend({},this.presets,e||{})),this.element&&this.options.parse){var i=$(this.element).attr(this.options.parse);i&&(i=parseJson(i,this.options.parseSecure))&&this.setOptions(i)}this.url=(this.element?this.element.attr("href"):t)||this.options.url||"",this.assignOptions();var s=s||this.options.handler;if(s)return this.setContent(s,this.parsers[s].call(this,!0));var n=this;return $.each(this.parsers,(function(t,e){var i=e.call(n);return!!i&&(n.setContent(t,i),!0)}))},fromElement:function(t,e){return this.open(t,e)},assignOptions:function(){$(this.overlay).addClass(this.options.classOverlay),$(this.win).addClass(this.options.classWindow)},close:function(t){var e=void 0!==t;if(e&&(t.stopPropagation(),t.preventDefault()),!this.isOpen)return this;if(e){var i=!1;if($.isFunction(this.options.closable)&&!this.options.closable.call(this,t)?i=!0:function(){return this.options.closable}.call(this,t)||(i=!0),i)return this}return $(this.overlay).fadeOut(this.options.animate.overlay,$.proxy(this.toggleOverlay,this)),$(this.win).attr("aria-hidden","true"),$(this).trigger("onClose",[this.content]),this.trash(),this.toggleListeners(),this.isOpen=!1,this},trash:function(){return this.element=this.asset=null,$(this.content).empty(),this.options={},$(this).unbind()[0].setOptions(this.presets),$(this.closeBtn),this},onError:function(){this.asset=null,this.setContent("string",this.options.errorMsg||"An error occurred")},setContent:function(t,e){return!!this.handlers[t]&&(this.content[0].className="sbox-content-"+t,this.hideContent(),this.applyTimer=setTimeout($.proxy((function(){var i=this.handlers[t].call(this,e);i=$.isArray(i)?i:[i],this.applyContent.apply(this,i)}),this),this.options.animate.overlay),$(this.overlay).data("opacity")?this:(this.toggleOverlay(!0),$(this.overlay).fadeTo(this.options.animate.overlay,this.options.overlayOpacity),this.reposition()))},applyContent:function(t,e){if(this.isOpen||this.applyTimer){if(this.applyTimer=clearTimeout(this.applyTimer),t){this.isLoading&&this.toggleLoading(!1);var i=this;setTimeout((function(){$(i).trigger("onUpdate",[i.content])}),20)}else this.toggleLoading(!0);t&&$(this.content).append(t),this.isOpen?this.resize(e):(this.toggleListeners(!0),this.resize(e,!0),this.isOpen=!0,$(this.win).attr("aria-hidden","false"),$(this).trigger("onOpen",[this.content]))}},resize:function(t,e){this.showTimer=clearTimeout(this.showTimer||null);var i=getSize(this.doc),s=getScroll(this.doc);this.size=$.extend(this.isLoading?this.options.sizeLoading:this.options.size,t);var n=getSize(self);if(this.size.x==n.x&&(this.size.y=this.size.y-50,this.size.x=this.size.x-20),i.x>979)var o={width:this.size.x,height:this.size.y,left:parseInt(s.x+(i.x-this.size.x-this.options.marginInner.x)/2),top:parseInt(s.y+(i.y-this.size.y-this.options.marginInner.y)/2)};else o={width:i.x-40,height:i.y,left:parseInt(s.x+10),top:parseInt(s.y+20)};return this.hideContent(),e?($(this.win).css(o),this.showTimer=setTimeout($.proxy(this.showContent,this),50)):$(this.win).animate(o,this.options.animate.win,$.proxy(this.showContent,this)),this.reposition()},toggleListeners:function(t){var e=t?"on":"off";$(this.closeBtn)[e]("click",this.bound.close),$(this.overlay)[e]("click",this.bound.close),$(this.doc)[e]("keydown",this.bound.key)[e]("mousewheel",this.bound.scroll),$(this.doc.parentWindow||this.doc.defaultView)[e]("resize",this.bound.window)[e]("scroll",this.bound.window)},toggleLoading:function(t){this.isLoading=t,$(this.win)[t?"addClass":"removeClass"]("sbox-loading"),t&&($(this.win).attr("aria-busy",t),$(this).trigger("onLoading",[this.win]))},toggleOverlay:function(t){if(this.options.overlay){var e=getSize(this.doc).x;$(this.overlay).attr("aria-hidden",t?"false":"true"),$(this.doc.body)[t?"addClass":"removeClass"]("body-overlayed"),t?this.scrollOffset=getSize(this.doc.parentWindow||this.doc.defaultView).x-e:$(this.doc.body).css("margin-right","")}},showContent:function(){$(this.content).attr("opacity")&&$(this).trigger("onShow",[this.win]),$(this.content).fadeIn(this.options.animate.content,"easeOutExpo")},hideContent:function(){$(this.content).attr("opacity")||$(this).trigger("onHide",[this.win]),$(this.content).fadeOut(this.options.animate.content)},onKey:function(t){switch(t.key){case"esc":this.close(t);case"up":case"down":return!1}},checkTarget:function(t){return t.target!==this.content&&$(this.content).find(t.target)},reposition:function(){var t=getSize(this.doc),e=getScroll(this.doc),i=getScrollSize(this.doc),s=$(this.overlay).css("height"),n=parseInt(s);return i.y>n&&t.y>=n&&($(this.overlay).css({width:i.x+"px",height:i.y+"px"}),$(this.win).css({left:parseInt(e.x+(t.x-this.win.offsetWidth)/2-this.scrollOffset)+"px",top:parseInt(e.y+(t.y-this.win.offsetHeight)/2)+"px"})),$(this).trigger("onMove",[this.overlay,this.win])},handlers:{},parsers:{}},$.extend(ARK.squeezeBox.parsers,{image:function(t){return!(!t&&!/\.(?:jpg|png|gif)$/i.test(this.url))&&this.url},clone:function(t){if(getElement(this.options.target))return getElement(this.options.target);if(this.element&&!this.element.parentNode)return this.element;var e=this.url.match(/#([\w-]+)$/);return e?getElement(e[1]):!!t&&this.element},ajax:function(t){return!!(t||this.url&&!/^(?:javascript|#)/i.test(this.url))&&this.url},iframe:function(t){return!(!t&&!this.url)&&this.url},string:function(t){return!0}}),$.extend(ARK.squeezeBox.handlers,{image:function(t){var e,i=new Image;return this.asset=null,i.onload=i.onabort=i.onerror=$.proxy((function(){if(i.onload=i.onabort=i.onerror=null,i.width){var t=getSize(this.doc);t.x-=this.options.marginImage.x,t.y-=this.options.marginImage.y,e={x:i.width,y:i.height};for(var s=2;s--;)e.x>t.x?(e.y*=t.x/e.x,e.x=t.x):e.y>t.y&&(e.x*=t.y/e.y,e.y=t.y);e.x=parseInt(e.x),e.y=parseInt(e.y),this.asset=$(i),i=null,this.asset.attr("width",e.x),this.asset.attr("height",e.y),this.applyContent(this.asset,e)}else setTimeout($.proxy(this.onError,this),10)}),this),i.src=t,i&&i.onload&&i.complete&&i.onload(),this.asset?[this.asset,e]:null},clone:function(t){return t?$(t).clone():this.onError()},adopt:function(t){return t||this.onError()},ajax:function(t){var e=this.options.ajaxOptions||{},i=this;this.asset=$.ajax($.extend({url:t,method:"GET",datatype:"html",cache:!1,async:!0,complete:function(t){200!=t.status?setTimeout((function(){i.onError.call(i)}),10):setTimeout((function(){!function(t){i.applyContent(t),$(i).trigger("onAjax",[t,i.asset]),i.asset=null}(t.responseText)}),setTimeout)}},e))},iframe:function(t){var e=getSize(this.doc);if(e.x>979)var i=this.options.size.x,s=this.options.size.y;else i=e.x,s=e.y-50;return this.asset=$("<iframe></iframe>").attr($.extend({src:t,frameBorder:0,width:i,height:s},this.options.iframeOptions||{})),this.options.iframePreload?(this.asset.on("load",$.proxy((function(){this.applyContent($(this.asset).css("display","")),this.asset.off("load")}),this)),$(this.asset).css("display","none").appendTo(this.content),!1):this.asset},string:function(t){return t}}),ARK.squeezeBox.handlers.url=ARK.squeezeBox.handlers.ajax,ARK.squeezeBox.parsers.url=ARK.squeezeBox.parsers.ajax,ARK.squeezeBox.parsers.adopt=ARK.squeezeBox.parsers.clone,$.fn.squeezeBox=function(t,e){return e?ARK.squeezeBox.open(this,t):ARK.squeezeBox.assign(this,t)})})));