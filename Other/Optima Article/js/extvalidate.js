/**
 * JFormValidator extension for ExtValidate
 * 
 * @author Sergey Gribinichenko
 * @version $Id$
 * @package ExtValidate
 * @subpackage Plugin.System
 * @copyright Copyright (c) 2009-2011 VBizSoft. All rights reserved.
 * @license GNU/GPL, alternative MPL
 */
var JFormValidator=function(){var e,t,a,r,i,n=function(e,a,r){r=""===r||r,t[e]={enabled:r,exec:a}},o=function(e,t){if("INPUT"==t.prop("tagName")&&"radio"==t.prop("type")&&t.form)for(var a=t.find('input[name="'+t.prop("name")+'"]'),r=0;r<a.length;r++)p(a[r],e);else"file"==t.prop("type")||p(t,e)},d=function(a){var r=(a=e(a)).val();if(a.prop("disabled")||a.prop("readonly")&&!a.hasClass("required"))return o(!0,a),!0;if(a.hasClass("required"))switch(a.prop("tagName")){case"FIELDSET":if(a.hasClass("radio")||a.hasClass("checkboxes"))for(var i=0;;i++){if(!e("#"+a.prop("id")+i).length)return o(!1,a),!1;if(e("#"+a.prop("id")+i).prop("checked"))break}break;default:if("INPUT"==a.prop("tagName")&&"text"==a.prop("type")||"TEXTAREA"==a.prop("tagName")){var n=a.attr("data-defval");r=e.trim(r),n&&n==r&&(r="")}if("checkbox"==a.prop("type"))return o(a.prop("checked"),a),a.prop("checked");if(!r)return o(!1,a),!1}var d=a.prop("className"),s=d&&-1!=d.search(/validate-([a-zA-Z0-9\_\-]+)/)?d.match(/validate-([a-zA-Z0-9\_\-]+)/)[1]:"";if(""==s)return o(!0,a),!0;if(s&&"none"!=s&&t[s]&&r){var p=t[s].exec(r,a);if(1!=p)return o(p,a),!1}return o(!0,a),!0},s=function(t){e(t).find("input,textarea,select,button").each((function(r,i){if(["INPUT","BUTTON"].contains(e(i).prop("tagName"))&&"submit"==e(i).prop("type"))e(i).hasClass("validate")&&(i.onclick=function(){return document.formvalidator.isValid(t)});else{var n=e(i).attr("data-defval");void 0!==n&&!1!==n&&(e(i).val().trim()||(e(i).val(e(i).attr("data-defval")),e(i).addClass("empty"))),e(i).blur((function(){var t=e(this);if(t.is("input")||t.is("textarea"))return null!=t.attr("data-defval")&&!t.val().trim()&&t.attr("data-defval").trim()&&(t.val(t.attr("data-defval")),t.addClass("empty")),d(this)})),e(i).focus((function(){var t=e(this),a=t.attr("data-defval");void 0!==a&&!1!==a&&t.val()===t.attr("data-defval")&&(t.val(""),t.removeClass("empty"))})),("SELECT"==e(i).prop("tag")||["checkbox","radio"].contains(e(i).prop("type")))&&i.addEvent("change",(function(){return d(this)})),e(i).hasClass("validate-email")&&a&&e(i).prop("type","email")}}))},p=function(t,a){var r,i,n,o,d=(r=t,o=e(i),r&&((n=o.find("#"+r+"-lbl")).length||(n=o.find('label[for="'+r+'"]')).length)?n:e()),s=e("#fieldError-"+t.prop("name"));s.data("defMsg")||s.data("defMsg",s.html()).html(""),!0===a?(t.removeClass("invalid"),d.removeClass("invalid"),s.html("").removeClass("visible")):(t.addClass("invalid"),d.addClass("invalid"),s.html(!1===a?s.data("defMsg"):a).addClass("visible"))};return e=jQuery.noConflict(),t={},r=r||{},(i=document.createElement("input")).setAttribute("type","email"),a="text"!==i.type,n("username",(function(e){return regex=new RegExp("[<|>|\"|'|%|;|(|)|&]","i"),!regex.test(e)})),n("password",(function(e){return regex=/^\S[\S ]{2,98}\S$/,regex.test(e)})),n("numeric",(function(e){return regex=/^(\d|-)?(\d|,)*\.?\d*$/,regex.test(e)})),n("email",(function(e,t){return e=punycode.toASCII(e),regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,!!regex.test(e)||t.prop("alt")||!1})),n("checked",(function(e,t){return t.checked})),n("longer",(function(e,t){var a=t.prop("className"),r=-1!=a.search(/size-([0-9]+)/)?a.match(/size-([0-9]+)/)[1]:0;return e.length>=r||t.prop("alt")||!1})),n("shorter",(function(e,t){var a=t.prop("className"),r=-1!=a.search(/size-([0-9]+)/)?a.match(/size-([0-9]+)/)[1]:0;return e.length<=r||t.prop("alt")||!1})),n("radio",(function(t,a){if(a.prop("form")){for(var r=e(a.prop("form")).find('input[name="'+a.prop("name")+'"]'),i=0,n=r.length;i<n;i++)if(r[i].checked)return!0;return!1}return!0})),e("form.form-validate").each((function(){s(this)})),{isValid:function(t){var a=!0;for(var i in e(t).find("fieldset").add(t.elements).each((function(e,t){0==d(t)&&(a=!1)})),r)if(1!=r[i].exec()){a=!1;break}return a},validate:d,setHandler:n,attachToForm:s,custom:r}},ExtvalidateInitReCaptcha2=function(){"use strict";for(var e,t,a=document.getElementsByClassName("g-recaptcha"),r=0,i=a.length;r<i;r++)t=(e=a[r]).dataset?e.dataset:{sitekey:e.getAttribute("data-sitekey"),theme:e.getAttribute("data-theme"),size:e.getAttribute("data-size")},grecaptcha.render(e,t)};function ExtValidateForm(e,t,a,r,i,n){var o=jQuery.noConflict();o("form."+e).each((function(e,n){(n=o(n)).prop({method:"post",action:"index.php?option=com_extvalidate&task=send"}),n.append(o('<input type="hidden" name="option" value="com_extvalidate" />')),n.append(o('<input type="hidden" name="task" value="send" />')),n.append(o('<input type="hidden" name="form" value="'+t+'" />')),n.append(o('<input type="hidden" name="'+i+'" value="1" />')),n.find('input[type="file"]').length>0&&n.prop("enctype","multipart/form-data"),addCaptcha=function(){if(a){var e=o(n.find("div."+a));if(0==e.length){var t=n.find('input[type="submit"]');t&&(e=o('<div class="'+a+'" />'),o(t).prepend(e))}var i="captcha_"+Math.floor(1e9*Math.random());e.prop("id",i),grecaptcha.render(e,{sitekey:r,theme:"light"})}},n.submit((function(){var e=document.formvalidator.isValid(this);if(a){var t=grecaptcha.getResponse(),r=!1;if(e&&t){r=!1;o.ajax({type:"POST",url:"index.php?option=com_extvalidate&task=check",data:"a="+t+"&"+i+"=1",async:!1,success:function(e){r=1==e}})}else r=!1;e?r?o("#fieldError-"+a).removeClass("visible"):o("#fieldError-"+a).addClass("visible"):t?o("#fieldError-"+a).removeClass("visible"):o("#fieldError-"+a).addClass("visible"),e=e&&r}return e}))}))}